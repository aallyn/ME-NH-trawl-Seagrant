---
pagetitle: "Seagrant ME-NH trawl survey <br> Objectve 2: Environmental Effects on NMDS"
author: "Jerelle Jesse"
output: 
  html_document: 
    toc: true
    toc_float: true
    code_folding: hide
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE,warning = FALSE)
knitr::opts_chunk$set(fig.width=12, fig.height=8) 
```

```{r, echo = FALSE}
# Access GMRI CSS Style
library(gmRi)
gmRi::use_gmri_style_rmd(css_file = "gmri_rmarkdown.css")
```


```{r echo=FALSE, message=FALSE}

#load packages
library(tidyverse)
library(vegan)
library(ggrepel)
library(ggforce)
library(ggnewscale)
library(ggthemes)
library(here)
library(rmarkdown)


#set up ggplot theme
theme_set(theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
        axis.text.x = element_text(colour = "black", face = "bold", size = 12),
        legend.text = element_text(size = 12, face ="bold", colour ="black"),
        legend.position = "right", 
        axis.title.y = element_text(face = "bold", size = 14, angle=90),
        axis.title.x = element_text(face = "bold", size = 12, colour = "black"),
        legend.title = element_text(size = 14, colour = "black", face = "bold"),
        panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 0.5),
        legend.key=element_blank()))



```


# Environmental Effects on Community structure NMDS
includes latitude, longitude, salinity, temperature, depth

## Functional Group Biomass

### NMDS
```{r}

#load in data
trawl_data_arrange<-read.csv(here("Data/group_biomass_matrix.csv"))[-1]

trawl_data<-read.csv(here("Data/MaineDMR_Trawl_Survey_Tow_Data_2021-05-14.csv"))

all_Data<-group_by(trawl_data, Season, Year, Region)%>%
  filter(Year<2020)%>%
  summarise(start_lat=mean(Start_Latitude),start_long=mean(Start_Longitude),end_lat=mean(End_Latitude), end_long=mean(End_Longitude),start_depth=mean(Start_Depth_fathoms, na.rm=TRUE), end_depth=mean(End_Depth_fathoms, na.rm=TRUE), bottom_temp=mean(Bottom_WaterTemp_DegC, na.rm=TRUE), bottom_sal=mean(Bottom_Salinity, na.rm=TRUE),surface_temp=mean(Surface_WaterTemp_DegC, na.rm=TRUE), surface_sal=mean(Surface_Salinity, na.rm=TRUE))%>%
  full_join(trawl_data_arrange)%>%
  ungroup()

com<-select(all_Data, benthivore, benthos,piscivore,planktivore, undefined)

com<-vegdist(com, method="bray")

#convert com to a matrix
m_com = as.matrix(com)

set.seed(123)
nmds = metaMDS(m_com,k=2, distance = "bray", trymax = 200)
nmds



```

### Envfit
```{r}
env<-select(all_Data, start_lat, start_long, end_lat, end_long,start_depth, end_depth, bottom_temp, bottom_sal, surface_temp, surface_sal)

en<-envfit(nmds, env, permutations=999, na.rm=TRUE)
en
plot(nmds)
plot(en)

en_coord_cont = as.data.frame(scores(en, "vectors")) * ordiArrowMul(en)
en_coord_cat = as.data.frame(scores(en, "factors")) * ordiArrowMul(en)

#extract NMDS scores for ggplot
data.scores = as.data.frame(scores(nmds))
#add columns to data frame 
data.scores$Region = all_Data$Region
data.scores$Year = all_Data$Year
data.scores$Season= all_Data$Season
data.scores$Year_groups= all_Data$YEAR_GROUPS
data.scores$Year_decades= all_Data$YEAR_DECADES
data.scores$Region_new=all_Data$REGION_NEW
data.scores$Region_year=all_Data$REGION_YEAR
data.scores$Season_year=all_Data$SEASON_YEAR

```


#### Region groups
```{r}
p_region<- ggplot()+
     geom_point(data = data.scores, aes(x = NMDS1, y = NMDS2, color=Region_new), size = 4) + 
  scale_color_colorblind()+
        geom_segment(data=en_coord_cont, aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2), size =1.5, alpha = 0.5)+
   geom_text(data = en_coord_cont, aes(x = NMDS1, y = NMDS2), size=5, 
       fontface = "bold", label = row.names(en_coord_cont))+
  theme(axis.title = element_text(size = 16, face = "bold"), 
       panel.background = element_blank(), panel.border = element_rect(fill = NA), 
       axis.ticks = element_blank(), axis.text = element_blank(), legend.key = element_blank(), 
       legend.title = element_text(size = 16, face = "bold"), 
       legend.text = element_text(size = 16))
       


p_region


```


#### Year groups
```{r}

p_year<- ggplot()+
     geom_point(data = data.scores, aes(x = NMDS1, y = NMDS2, color=Year_groups), size = 4) + 
  scale_color_colorblind()+
        geom_segment(data=en_coord_cont, aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2), size =1.5, alpha = 0.5)+
   geom_text(data = en_coord_cont, aes(x = NMDS1, y = NMDS2), size=5, 
       fontface = "bold", label = row.names(en_coord_cont))+
  theme(axis.title = element_text(size = 16, face = "bold"), 
       panel.background = element_blank(), panel.border = element_rect(fill = NA), 
       axis.ticks = element_blank(), axis.text = element_blank(), legend.key = element_blank(), 
       legend.title = element_text(size = 16, face = "bold"), 
       legend.text = element_text(size = 16))

p_year

```


### GAM contours for environmental effects

#### Bottom temperature
```{r}
bottom_temp<-ordisurf(nmds, env$bottom_temp)


ordi.grid <- bottom_temp$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### Surface temperature
```{r}
surface_temp<-ordisurf(nmds, env$surface_temp)

ordi.grid <- surface_temp$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### Bottom salinity
```{r}
bottom_sal<-ordisurf(nmds, env$bottom_sal)

ordi.grid <- bottom_sal$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2
```


#### Surface salinity
```{r}
surface_sal<-ordisurf(nmds, env$surface_sal)

ordi.grid <- surface_sal$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### start latitude
```{r}
start_lat<-ordisurf(nmds, env$start_lat)

ordi.grid <- start_lat$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Latitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Latitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2
```


#### start longitude
```{r}
start_long<-ordisurf(nmds, env$start_long)

ordi.grid <- start_long$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Longitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Longitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### start depth
```{r}
start_depth<-ordisurf(nmds, env$start_depth)

ordi.grid <- start_depth$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Depth")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Depth")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2
```


## Top 50 Species Biomass

### NMDS
```{r}

#load in data
trawl_data_arrange<-read.csv(here("Data/species_biomass_matrix.csv"))[-1]

trawl_data<-read.csv(here("Data/MaineDMR_Trawl_Survey_Tow_Data_2021-05-14.csv"))

all_Data<-group_by(trawl_data, Season, Year, Region)%>%
  filter(Year<2020)%>%
  summarise(start_lat=mean(Start_Latitude),start_long=mean(Start_Longitude),end_lat=mean(End_Latitude), end_long=mean(End_Longitude),start_depth=mean(Start_Depth_fathoms, na.rm=TRUE), end_depth=mean(End_Depth_fathoms, na.rm=TRUE), bottom_temp=mean(Bottom_WaterTemp_DegC, na.rm=TRUE), bottom_sal=mean(Bottom_Salinity, na.rm=TRUE),surface_temp=mean(Surface_WaterTemp_DegC, na.rm=TRUE), surface_sal=mean(Surface_Salinity, na.rm=TRUE))%>%
  full_join(trawl_data_arrange)%>%
  ungroup()

com<-select(all_Data, 14:63)

com<-vegdist(com, method="bray")

#convert com to a matrix
m_com = as.matrix(com)

set.seed(123)
nmds = metaMDS(m_com,k=2, distance = "bray", trymax = 500)
nmds



```

### Envfit
```{r}
env<-select(all_Data, start_lat, start_long, end_lat, end_long,start_depth, end_depth, bottom_temp, bottom_sal, surface_temp, surface_sal)

en<-envfit(nmds, env, permutations=999, na.rm=TRUE)
en
plot(nmds)
plot(en)

en_coord_cont = as.data.frame(scores(en, "vectors")) * ordiArrowMul(en)
en_coord_cat = as.data.frame(scores(en, "factors")) * ordiArrowMul(en)

#extract NMDS scores for ggplot
data.scores = as.data.frame(scores(nmds))
#add columns to data frame 
data.scores$Region = all_Data$Region
data.scores$Year = all_Data$Year
data.scores$Season= all_Data$Season
data.scores$Year_groups= all_Data$YEAR_GROUPS
data.scores$Year_decades= all_Data$YEAR_DECADES
data.scores$Region_new=all_Data$REGION_NEW
data.scores$Region_year=all_Data$REGION_YEAR
data.scores$Season_year=all_Data$SEASON_YEAR

```


#### Region groups
```{r}
p_region<- ggplot()+
     geom_point(data = data.scores, aes(x = NMDS1, y = NMDS2, color=Region_new), size = 4) + 
  scale_color_colorblind()+
        geom_segment(data=en_coord_cont, aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2), size =1.5, alpha = 0.5)+
   geom_text(data = en_coord_cont, aes(x = NMDS1, y = NMDS2), size=5, 
       fontface = "bold", label = row.names(en_coord_cont))+
  theme(axis.title = element_text(size = 16, face = "bold"), 
       panel.background = element_blank(), panel.border = element_rect(fill = NA), 
       axis.ticks = element_blank(), axis.text = element_blank(), legend.key = element_blank(), 
       legend.title = element_text(size = 16, face = "bold"), 
       legend.text = element_text(size = 16))
       


p_region


```


#### Year groups
```{r}

p_year<- ggplot()+
     geom_point(data = data.scores, aes(x = NMDS1, y = NMDS2, color=Year_groups), size = 4) + 
  scale_color_colorblind()+
        geom_segment(data=en_coord_cont, aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2), size =1.5, alpha = 0.5)+
   geom_text(data = en_coord_cont, aes(x = NMDS1, y = NMDS2), size=5, 
       fontface = "bold", label = row.names(en_coord_cont))+
  theme(axis.title = element_text(size = 16, face = "bold"), 
       panel.background = element_blank(), panel.border = element_rect(fill = NA), 
       axis.ticks = element_blank(), axis.text = element_blank(), legend.key = element_blank(), 
       legend.title = element_text(size = 16, face = "bold"), 
       legend.text = element_text(size = 16))

p_year

```


### GAM contours for environmental effects

#### Bottom temperature
```{r}
bottom_temp<-ordisurf(nmds, env$bottom_temp)


ordi.grid <- bottom_temp$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### Surface temperature
```{r}
surface_temp<-ordisurf(nmds, env$surface_temp)

ordi.grid <- surface_temp$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### Bottom salinity
```{r}
bottom_sal<-ordisurf(nmds, env$bottom_sal)

ordi.grid <- bottom_sal$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2
```


#### Surface salinity
```{r}
surface_sal<-ordisurf(nmds, env$surface_sal)

ordi.grid <- surface_sal$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### start latitude
```{r}
start_lat<-ordisurf(nmds, env$start_lat)

ordi.grid <- start_lat$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Latitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Latitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2
```


#### start longitude
```{r}
start_long<-ordisurf(nmds, env$start_long)

ordi.grid <- start_long$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Longitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Longitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### start depth
```{r}
start_depth<-ordisurf(nmds, env$start_depth)

ordi.grid <- start_depth$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Depth")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Depth")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2
```


## Funcitonal Group Abundance

### NMDS
```{r}

#load in data
trawl_data_arrange<-read.csv(here("Data/group_abundance_matrix.csv"))[-1]

trawl_data<-read.csv(here("Data/MaineDMR_Trawl_Survey_Tow_Data_2021-05-14.csv"))

all_Data<-group_by(trawl_data, Season, Year, Region)%>%
  filter(Year<2020)%>%
  summarise(start_lat=mean(Start_Latitude),start_long=mean(Start_Longitude),end_lat=mean(End_Latitude), end_long=mean(End_Longitude),start_depth=mean(Start_Depth_fathoms, na.rm=TRUE), end_depth=mean(End_Depth_fathoms, na.rm=TRUE), bottom_temp=mean(Bottom_WaterTemp_DegC, na.rm=TRUE), bottom_sal=mean(Bottom_Salinity, na.rm=TRUE),surface_temp=mean(Surface_WaterTemp_DegC, na.rm=TRUE), surface_sal=mean(Surface_Salinity, na.rm=TRUE))%>%
  full_join(trawl_data_arrange)%>%
  ungroup()

com<-select(all_Data,benthivore, benthos,piscivore,planktivore, undefined )

com<-vegdist(com, method="bray", na.rm=TRUE)

#convert com to a matrix
m_com = as.matrix(com)

set.seed(123)
nmds = metaMDS(m_com,k=2, distance = "bray", trymax = 200)
nmds



```

### Envfit
```{r}
env<-select(all_Data, start_lat, start_long, end_lat, end_long,start_depth, end_depth, bottom_temp, bottom_sal, surface_temp, surface_sal)

en<-envfit(nmds, env, permutations=999, na.rm=TRUE)
en
plot(nmds)
plot(en)

en_coord_cont = as.data.frame(scores(en, "vectors")) * ordiArrowMul(en)
en_coord_cat = as.data.frame(scores(en, "factors")) * ordiArrowMul(en)

#extract NMDS scores for ggplot
data.scores = as.data.frame(scores(nmds))
#add columns to data frame 
data.scores$Region = all_Data$Region
data.scores$Year = all_Data$Year
data.scores$Season= all_Data$Season
data.scores$Year_groups= all_Data$YEAR_GROUPS
data.scores$Year_decades= all_Data$YEAR_DECADES
data.scores$Region_new=all_Data$REGION_NEW
data.scores$Region_year=all_Data$REGION_YEAR
data.scores$Season_year=all_Data$SEASON_YEAR

```


#### Region groups
```{r}
p_region<- ggplot()+
     geom_point(data = data.scores, aes(x = NMDS1, y = NMDS2, color=Region_new), size = 4) + 
  scale_color_colorblind()+
        geom_segment(data=en_coord_cont, aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2), size =1.5, alpha = 0.5)+
   geom_text(data = en_coord_cont, aes(x = NMDS1, y = NMDS2), size=5, 
       fontface = "bold", label = row.names(en_coord_cont))+
  theme(axis.title = element_text(size = 16, face = "bold"), 
       panel.background = element_blank(), panel.border = element_rect(fill = NA), 
       axis.ticks = element_blank(), axis.text = element_blank(), legend.key = element_blank(), 
       legend.title = element_text(size = 16, face = "bold"), 
       legend.text = element_text(size = 16))
       


p_region


```


#### Year groups
```{r}

p_year<- ggplot()+
     geom_point(data = data.scores, aes(x = NMDS1, y = NMDS2, color=Year_groups), size = 4) + 
  scale_color_colorblind()+
        geom_segment(data=en_coord_cont, aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2), size =1.5, alpha = 0.5)+
   geom_text(data = en_coord_cont, aes(x = NMDS1, y = NMDS2), size=5, 
       fontface = "bold", label = row.names(en_coord_cont))+
  theme(axis.title = element_text(size = 16, face = "bold"), 
       panel.background = element_blank(), panel.border = element_rect(fill = NA), 
       axis.ticks = element_blank(), axis.text = element_blank(), legend.key = element_blank(), 
       legend.title = element_text(size = 16, face = "bold"), 
       legend.text = element_text(size = 16))

p_year

```


### GAM contours for environmental effects

#### Bottom temperature
```{r}
bottom_temp<-ordisurf(nmds, env$bottom_temp)


ordi.grid <- bottom_temp$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### Surface temperature
```{r}
surface_temp<-ordisurf(nmds, env$surface_temp)

ordi.grid <- surface_temp$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### Bottom salinity
```{r}
bottom_sal<-ordisurf(nmds, env$bottom_sal)

ordi.grid <- bottom_sal$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2
```


#### Surface salinity
```{r}
surface_sal<-ordisurf(nmds, env$surface_sal)

ordi.grid <- surface_sal$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### start latitude
```{r}
start_lat<-ordisurf(nmds, env$start_lat)

ordi.grid <- start_lat$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Latitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Latitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2
```


#### start longitude
```{r}
start_long<-ordisurf(nmds, env$start_long)

ordi.grid <- start_long$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Longitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Longitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### start depth
```{r}
start_depth<-ordisurf(nmds, env$start_depth)

ordi.grid <- start_depth$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Depth")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Depth")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2
```


## Top 50 Species Abundance

### NMDS
```{r}

#load in data
trawl_data_arrange<-read.csv(here("Data/species_abundance_matrix.csv"))[-1]

trawl_data<-read.csv(here("Data/MaineDMR_Trawl_Survey_Tow_Data_2021-05-14.csv"))

all_Data<-group_by(trawl_data, Season, Year, Region)%>%
  filter(Year<2020)%>%
  summarise(start_lat=mean(Start_Latitude),start_long=mean(Start_Longitude),end_lat=mean(End_Latitude), end_long=mean(End_Longitude),start_depth=mean(Start_Depth_fathoms, na.rm=TRUE), end_depth=mean(End_Depth_fathoms, na.rm=TRUE), bottom_temp=mean(Bottom_WaterTemp_DegC, na.rm=TRUE), bottom_sal=mean(Bottom_Salinity, na.rm=TRUE),surface_temp=mean(Surface_WaterTemp_DegC, na.rm=TRUE), surface_sal=mean(Surface_Salinity, na.rm=TRUE))%>%
  full_join(trawl_data_arrange)%>%
  ungroup()

com<-select(all_Data, 14:63)

com<-vegdist(com, method="bray")

#convert com to a matrix
m_com = as.matrix(com)

set.seed(123)
nmds = metaMDS(m_com,k=2, distance = "bray", trymax = 200)
nmds



```

### Envfit
```{r}
env<-select(all_Data, start_lat, start_long, end_lat, end_long,start_depth, end_depth, bottom_temp, bottom_sal, surface_temp, surface_sal)

en<-envfit(nmds, env, permutations=999, na.rm=TRUE)
en
plot(nmds)
plot(en)

en_coord_cont = as.data.frame(scores(en, "vectors")) * ordiArrowMul(en)
en_coord_cat = as.data.frame(scores(en, "factors")) * ordiArrowMul(en)

#extract NMDS scores for ggplot
data.scores = as.data.frame(scores(nmds))
#add columns to data frame 
data.scores$Region = all_Data$Region
data.scores$Year = all_Data$Year
data.scores$Season= all_Data$Season
data.scores$Year_groups= all_Data$YEAR_GROUPS
data.scores$Year_decades= all_Data$YEAR_DECADES
data.scores$Region_new=all_Data$REGION_NEW
data.scores$Region_year=all_Data$REGION_YEAR
data.scores$Season_year=all_Data$SEASON_YEAR

```


#### Region groups
```{r}
p_region<- ggplot()+
     geom_point(data = data.scores, aes(x = NMDS1, y = NMDS2, color=Region_new), size = 4) + 
  scale_color_colorblind()+
        geom_segment(data=en_coord_cont, aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2), size =1.5, alpha = 0.5)+
   geom_text(data = en_coord_cont, aes(x = NMDS1, y = NMDS2), size=5, 
       fontface = "bold", label = row.names(en_coord_cont))+
  theme(axis.title = element_text(size = 16, face = "bold"), 
       panel.background = element_blank(), panel.border = element_rect(fill = NA), 
       axis.ticks = element_blank(), axis.text = element_blank(), legend.key = element_blank(), 
       legend.title = element_text(size = 16, face = "bold"), 
       legend.text = element_text(size = 16))
       


p_region


```


#### Year groups
```{r}

p_year<- ggplot()+
     geom_point(data = data.scores, aes(x = NMDS1, y = NMDS2, color=Year_groups), size = 4) + 
  scale_color_colorblind()+
        geom_segment(data=en_coord_cont, aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2), size =1.5, alpha = 0.5)+
   geom_text(data = en_coord_cont, aes(x = NMDS1, y = NMDS2), size=5, 
       fontface = "bold", label = row.names(en_coord_cont))+
  theme(axis.title = element_text(size = 16, face = "bold"), 
       panel.background = element_blank(), panel.border = element_rect(fill = NA), 
       axis.ticks = element_blank(), axis.text = element_blank(), legend.key = element_blank(), 
       legend.title = element_text(size = 16, face = "bold"), 
       legend.text = element_text(size = 16))

p_year

```


### GAM contours for environmental effects

#### Bottom temperature
```{r}
bottom_temp<-ordisurf(nmds, env$bottom_temp)


ordi.grid <- bottom_temp$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### Surface temperature
```{r}
surface_temp<-ordisurf(nmds, env$surface_temp)

ordi.grid <- surface_temp$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Temperature")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### Bottom salinity
```{r}
bottom_sal<-ordisurf(nmds, env$bottom_sal)

ordi.grid <- bottom_sal$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Bottom Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2
```


#### Surface salinity
```{r}
surface_sal<-ordisurf(nmds, env$surface_sal)

ordi.grid <- surface_sal$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Surface Salinity")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### start latitude
```{r}
start_lat<-ordisurf(nmds, env$start_lat)

ordi.grid <- start_lat$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Latitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Latitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2
```


#### start longitude
```{r}
start_long<-ordisurf(nmds, env$start_long)

ordi.grid <- start_long$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Longitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Longitude")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2

```


#### start depth
```{r}
start_depth<-ordisurf(nmds, env$start_depth)

ordi.grid <- start_depth$grid #extracts the ordisurf object
str(ordi.grid) #it's a list though - cannot be plotted as is
ordi.mite <- expand.grid(x = ordi.grid$x, y = ordi.grid$y) #get x and ys
ordi.mite$z <- as.vector(ordi.grid$z) #unravel the matrix for the z scores
contour.vals <- data.frame(na.omit(ordi.mite)) #gets rid of the nas
 

p1 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Depth")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Year_groups), size = 4 )+ scale_color_colorblind()
  
p2 <- ggplot()+
  stat_contour(data = contour.vals, aes(x, y, z=z, color = ..level..),position="identity",size=2)+
  labs(x = "NMDS1", y = "NMDS2", color="Depth")+
  new_scale_color()+
  geom_point(data = data.scores, aes(NMDS1, NMDS2, color=Region_new), size = 4 )+ scale_color_colorblind()

p1
p2
```
